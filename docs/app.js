$(document).ready(function(){function t(t){var e=$(t.target).prev();e.clone().insertAfter(e)}function e(t){var e=[],r=[],a=[];$("div.inputs div").each(function(t,n){var r=parseFloat($(n).find(".input-width").val()),a=parseFloat($(n).find(".input-length").val());e.push({h:_.min([r,a]),w:_.max([r,a])})}),$("div.targets div").each(function(t,e){e=$(e);var n=parseFloat($(e).find(".target-width").val()),a=parseFloat($(e).find(".target-length").val());r.push({long:_.max([n,a]),short:_.min([n,a]),label:n+"x"+a})});var i=new Packer(e[0].w,e[0].h);r=_.orderBy(r,function(t){return t.long*t.short},["desc"]),_.each(r,function(t){t.w=t.long,t.h=t.short}),r=i.fit(r),_.each(r,function(t,e,n){t.fit||a.push(r.splice(e,1))}),n(e,r,a)}function n(t,e){var n=t[0].w,r=t[0].h,a=5,i=20;d3.selectAll("svg").remove(),d3.select("#output").append("svg").attr("width",n*a+i).attr("height",r*a+i);var c=d3.select("svg");c.selectAll(".source").data(t).enter().append("rect").attr("class","source").attr("width",function(t){return t.w*a}).attr("height",function(t){return t.h*a}).attr("x",i/2).attr("y",i/2),c.selectAll(".cut").data(e).enter().append("rect").attr("class","cut").attr("x",function(t){if(t.fit)return i/2+t.fit.x*a}).attr("y",function(t){if(t.fit)return i/2+t.fit.y*a}).attr("width",function(t){if(t.fit)return t.w*a}).attr("height",function(t){if(t.fit)return t.h*a}),c.selectAll(".label").data(e).enter().append("text").attr("class","label").attr("x",function(t){if(t.fit)return i/2+t.fit.x*a+5}).attr("y",function(t){if(t.fit)return i/2+t.fit.y*a+15}).text(function(t){return t.label})}$("#addTarget").click(t),$("#calculate").click(e)});